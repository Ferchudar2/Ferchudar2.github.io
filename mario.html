<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Web_GitHub - Unificado (Single File)</title>
<style>
  /* ---------- Estética moderna ---------- */
  :root{
    --bg:#f4f7fb; --card:#ffffff; --primary:#2563eb; --primary-600:#1e40af;
    --muted:#6b7280; --success:#10b981;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background:linear-gradient(180deg, var(--bg) 0%, #eef4ff 100%);
    color:#111827; padding-top:68px;
  }
  header#main-header{
    position:fixed; top:0; left:0; right:0; height:68px;
    background:linear-gradient(90deg,var(--primary),var(--primary-600));
    color:white; display:flex; align-items:center; box-shadow:0 6px 18px rgba(16,24,40,0.12); z-index:999;
  }
  .header-content{width:100%; max-width:1200px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:0 20px;}
  .logo{font-weight:700; letter-spacing:0.3px}
  nav ul{display:flex; gap:10px; margin:0; padding:0; list-style:none; align-items:center}
  nav a{color:white; text-decoration:none; padding:8px 12px; border-radius:8px; font-weight:600; font-size:0.95rem}
  nav a:hover{background:rgba(255,255,255,0.12)}
  .user-info{display:flex; gap:8px; align-items:center}
  .user-badge{background:rgba(255,255,255,0.12); padding:6px 10px; border-radius:999px; font-weight:600}
  .btn-ghost{background:transparent; border:1px solid rgba(255,255,255,0.12); color:white; padding:6px 10px; border-radius:8px; cursor:pointer}
  /* ---------- Layout ---------- */
  .wrap{max-width:1200px; margin:24px auto; padding:0 20px}
  .page{display:none}
  .page.active{display:block}
  .grid{display:grid; gap:20px}
  /* ---------- Card / Forms ---------- */
  .card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 8px 30px rgba(13,38,76,0.06)}
  .container{max-width:720px; margin:0 auto}
  h2{margin:0 0 12px; font-size:1.2rem}
  form{display:grid; gap:12px}
  input[type="text"], input[type="password"], input[type="email"], input[type="number"], select, textarea{
    width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6e9ef; font-size:1rem; background:white;
  }
  label{font-size:0.9rem; color:var(--muted)}
  button.primary{background:var(--primary); color:white; padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:700}
  button.danger{background:#ef4444;color:white;padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
  .muted{color:var(--muted); font-size:0.9rem}
  .table{width:100%; border-collapse:collapse}
  th, td{padding:12px 10px; border-bottom:1px solid #f1f5f9; text-align:left}
  th{font-size:0.85rem; color:var(--muted); text-transform:uppercase}
  .actions{display:flex; gap:8px; justify-content:center}
  img.product-img{width:60px;height:60px;object-fit:cover;border-radius:8px; border:1px solid #e6e9ef}
  .top-row{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px}
  .help{font-size:0.88rem; color:var(--muted)}
  .center{display:flex; align-items:center; gap:8px}
  .small{font-size:0.85rem; padding:6px 8px; border-radius:8px}
  /* responsive */
  @media (min-width:900px){
    .grid-2{grid-template-columns:1fr 360px}
  }
  /* mensajes */
  #msg{max-width:1200px; margin:12px auto; text-align:center; color:var(--muted)}
  footer{max-width:1200px;margin:24px auto;text-align:center;color:var(--muted);padding:0 20px}
  input[type=file]{padding:8px}
</style>
</head>
<body>

<header id="main-header">
  <div class="header-content">
    <div style="display:flex;align-items:center;gap:16px">
      <div class="logo">Web_GitHub</div>
      <nav><ul>
        <li><a href="#productos" data-link>Productos</a></li>
        <li><a href="#agregar" data-link class="nav-admin">Agregar</a></li>
        <li><a href="#registro" data-link>Registro</a></li>
        <li><a href="#login" data-link>Iniciar Sesión</a></li>
        <li><a href="#admin" data-link class="nav-admin">Usuarios</a></li>
      </ul></nav>
    </div>
    <div class="user-info">
      <div id="user-display" class="user-badge" style="display:none"></div>
      <button id="logout-btn" class="btn-ghost" style="display:none">Cerrar sesión</button>
    </div>
  </div>
</header>

<div id="msg"></div>

<main class="wrap">

  <!-- PRODUCTOS -->
  <section id="productos" class="page active">
    <div class="card">
      <div class="top-row">
        <div>
          <h2>Productos disponibles</h2>
          <div class="help">Mirá los productos. Si sos administrador podés agregar o modificar.</div>
        </div>
        <div>
          <span id="contador-productos" class="muted"></span>
        </div>
      </div>

      <div class="card" style="padding:12px">
        <table class="table" id="productos-table">
          <thead>
            <tr><th>Imagen</th><th>Nombre</th><th>Precio</th><th style="text-align:center">Stock</th><th style="text-align:center">Acciones</th></tr>
          </thead>
          <tbody id="productos-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- AGREGAR PRODUCTO -->
  <section id="agregar" class="page">
    <div class="container">
      <div class="card">
        <h2>Agregar nuevo producto</h2>
        <form id="form-agregar">
          <label>Nombre</label>
          <input id="prod-nombre" required placeholder="Ej: Silla de ruedas" />
          <label>Precio</label>
          <input id="prod-precio" type="number" step="0.01" required />
          <label>Stock</label>
          <input id="prod-stock" type="number" required />
          <label>Imagen (subila desde tu PC)</label>
          <input id="prod-img" type="file" accept="image/*" />
          <div class="center">
            <button class="primary" type="submit">Guardar producto</button>
            <button type="button" class="small" onclick="routeTo('#productos')">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- EDITAR PRODUCTO -->
  <section id="editar" class="page">
    <div class="container">
      <div class="card">
        <h2>Editar producto</h2>
        <form id="form-editar">
          <!-- campos inyectados dinámicamente -->
          <div class="center" style="margin-top:8px">
            <button class="primary" type="submit">Actualizar producto</button>
            <button type="button" class="small" onclick="routeTo('#productos')">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- LOGIN -->
  <section id="login" class="page">
    <div class="container">
      <div class="card">
        <h2>Iniciar sesión</h2>
        <form id="form-login">
          <label>Usuario</label>
          <input name="usuario" required />
          <label>Contraseña</label>
          <input name="password" type="password" required />
          <div style="display:flex;gap:10px;margin-top:8px">
            <button class="primary" type="submit">Ingresar</button>
            <button type="button" class="small" onclick="routeTo('#registro')">Crear cuenta</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- REGISTRO -->
  <section id="registro" class="page">
    <div class="container">
      <div class="card">
        <h2>Registro</h2>
        <form id="form-registro">
          <label>Usuario</label>
          <input id="reg-usuario" required />
          <label>Nombre</label>
          <input id="reg-nombre" required />
          <label>Email (opcional)</label>
          <input id="reg-email" type="email" />
          <label>Contraseña</label>
          <input id="reg-password" type="password" required />
          <label><input id="reg-isadmin" type="checkbox" /> Registrar como administrador</label>
          <div style="display:flex;gap:10px;margin-top:8px">
            <button class="primary" type="submit">Registrar</button>
            <button type="button" class="small" onclick="routeTo('#login')">Volver a Iniciar</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- ADMIN USUARIOS -->
  <section id="admin" class="page">
    <div class="card">
      <h2>Administración de usuarios</h2>
      <div class="help">Cambiar roles de usuarios (no puedes cambiar tu propio rol desde aquí).</div>
      <div style="overflow:auto;margin-top:12px">
        <table class="table">
          <thead><tr><th>Usuario</th><th>Nombre</th><th>Email</th><th>Rol</th><th>Acción</th></tr></thead>
          <tbody id="usuarios-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

</main>

<footer>Single-file demo • guardado en localStorage • imágenes almacenadas como Base64</footer>

<script>
/* ---------- Almacenamiento ---------- */
const LS_USERS = 'gh_users_v1';
const LS_PRODS = 'gh_products_v1';
const LS_SESSION = 'gh_session_v1';

function getUsuarios(){ return JSON.parse(localStorage.getItem(LS_USERS) || '[]'); }
function saveUsuarios(u){ localStorage.setItem(LS_USERS, JSON.stringify(u)); }
function getProductos(){ return JSON.parse(localStorage.getItem(LS_PRODS) || '[]'); }
function saveProductos(p){ localStorage.setItem(LS_PRODS, JSON.stringify(p)); }
function setSession(u){ localStorage.setItem(LS_SESSION, JSON.stringify(u)); }
function getSession(){ return JSON.parse(localStorage.getItem(LS_SESSION) || 'null'); }
function clearSession(){ localStorage.removeItem(LS_SESSION); }

/* ---------- Inicial (no admin pre-creado) ---------- */
function seedIfEmpty(){
  if(!localStorage.getItem(LS_PRODS)){
    const demo = [
      {id:1,nombre:'Silla de ruedas',precio:15000,stock:5, imagen:'https://via.placeholder.com/120'},
      {id:2,nombre:'Horse Mount Kit',precio:25000,stock:2, imagen:'https://via.placeholder.com/120'}
    ];
    saveProductos(demo);
  }
}
seedIfEmpty();

/* ---------- Router simple (hash) ---------- */
function hideAll(){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); }
function parseHash(){
  const h = location.hash || '#productos'; const [s,q]=h.split('?'); return {section:s, params: new URLSearchParams(q||'')};
}
function routeTo(hash){ location.hash = hash; }
function router(){
  const {section, params} = parseHash();
  hideAll();
  // default
  switch(section){
    case '#agregar':
      if(!isAdmin()){ showMsg('Acceso denegado. Solo administradores.',4000); routeTo('#login'); return; }
      document.getElementById('agregar').classList.add('active'); break;
    case '#editar':
      if(!isAdmin()){ showMsg('Acceso denegado. Solo administradores.',4000); routeTo('#login'); return; }
      document.getElementById('editar').classList.add('active');
      const id = parseInt(params.get('id')); if(!isNaN(id)) loadEditarForm(id); break;
    case '#login': document.getElementById('login').classList.add('active'); break;
    case '#registro': document.getElementById('registro').classList.add('active'); break;
    case '#admin':
      if(!isAdmin()){ showMsg('Acceso denegado. Solo administradores.',4000); routeTo('#login'); return; }
      document.getElementById('admin').classList.add('active'); renderUsuarios(); break;
    case '#productos':
    default:
      document.getElementById('productos').classList.add('active'); renderProductos(); break;
  }
}
window.addEventListener('hashchange', router);

/* ---------- Mensajes ---------- */
let msgTimer = null;
function showMsg(t, timeout=2500){
  const el = document.getElementById('msg'); el.textContent = t;
  if(msgTimer) clearTimeout(msgTimer);
  if(timeout>0) msgTimer = setTimeout(()=>el.textContent='', timeout);
}

/* ---------- Nav / Sesión ---------- */
function renderNav(){
  const u = getSession();
  const disp = document.getElementById('user-display');
  const logout = document.getElementById('logout-btn');
  document.querySelectorAll('.nav-admin').forEach(el=> el.style.display = (u && u.rol==='admin') ? 'inline' : 'none');
  if(u){ disp.style.display='inline-block'; disp.textContent = u.nombre || u.usuario; logout.style.display='inline-block'; } else { disp.style.display='none'; logout.style.display='none'; }
}
document.getElementById('logout-btn').addEventListener('click', ()=>{
  clearSession(); renderNav(); routeTo('#login'); showMsg('Sesión cerrada',1500);
});

/* ---------- Render Productos ---------- */
function renderProductos(){
  const tbody = document.getElementById('productos-tbody'); tbody.innerHTML='';
  const productos = getProductos();
  document.getElementById('contador-productos').textContent = `${productos.length} productos`;
  if(productos.length===0){ tbody.innerHTML = '<tr><td colspan=5 style="text-align:center">No hay productos</td></tr>'; return; }
  const current = getSession();
  productos.forEach(p=>{
    const tr = document.createElement('tr');
    // imagen: si p.imagen existe (base64 o url), usarla; soporte antiguo p.imagen_url
    const imgSrc = p.imagen || p.imagen_url || 'https://via.placeholder.com/120';
    tr.innerHTML = `
      <td><img class="product-img" src="${imgSrc}" alt="${escapeHtml(p.nombre)}" /></td>
      <td>${escapeHtml(p.nombre)}</td>
      <td>$ ${Number(p.precio).toFixed(2)}</td>
      <td style="text-align:center">${p.stock}</td>
      <td style="text-align:center" class="actions">
        ${current && current.rol==='admin' ? `<button class="small" onclick="irEditar(${p.id})">Editar</button><button class="small" onclick="eliminarProducto(${p.id})">Eliminar</button>` : `<button class="small" onclick="comprar(${p.id})">Comprar</button>`}
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* comprar (simulado) */
function comprar(id){
  showMsg('Función de compra simulada (sin backend).',3000);
}

/* ---------- AGREGAR producto (con file -> base64) ---------- */
const prodImgInput = document.getElementById('prod-img');
let prodImgBase64 = ''; // guardará base64 temporal mientras sube
prodImgInput.addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  if(!f.type.startsWith('image/')){ alert('Seleccioná una imagen válida'); prodImgInput.value=''; return; }
  const r = new FileReader();
  r.onload = ()=>{ prodImgBase64 = r.result; };
  r.readAsDataURL(f);
});

document.getElementById('form-agregar').addEventListener('submit', (ev)=>{
  ev.preventDefault();
  if(!isAdmin()){ showMsg('Solo administradores pueden agregar productos',4000); routeTo('#login'); return; }
  const nombre = document.getElementById('prod-nombre').value.trim();
  const precio = parseFloat(document.getElementById('prod-precio').value);
  const stock = parseInt(document.getElementById('prod-stock').value);
  if(!nombre || isNaN(precio) || isNaN(stock)){ alert('Completá todos los campos'); return; }
  if(!prodImgBase64){ alert('Subí una imagen desde tu PC'); return; }
  const productos = getProductos();
  const id = productos.length? Math.max(...productos.map(x=>x.id))+1 : 1;
  productos.push({id, nombre, precio, stock, imagen: prodImgBase64});
  saveProductos(productos);
  prodImgBase64 = ''; document.getElementById('prod-img').value='';
  document.getElementById('form-agregar').reset();
  showMsg('Producto agregado'); renderProductos(); routeTo('#productos');
});

/* ---------- EDITAR producto ---------- */
let editImgBase64 = ''; // si el usuario sube una nueva imagen, se guarda aquí
function loadEditarForm(id){
  const productos = getProductos();
  const p = productos.find(x=>x.id===id);
  const form = document.getElementById('form-editar');
  if(!p){ form.innerHTML = '<p>Producto no encontrado.</p>'; return; }
  // render campos y file input
  form.innerHTML = `
    <label>Nombre</label>
    <input id="edit-nombre" value="${escapeHtmlAttr(p.nombre)}" required />
    <label>Precio</label>
    <input id="edit-precio" type="number" step="0.01" value="${Number(p.precio)}" required />
    <label>Stock</label>
    <input id="edit-stock" type="number" value="${Number(p.stock)}" required />
    <label>Imagen actual</label>
    <div style="display:flex;gap:12px;align-items:center">
      <img src="${p.imagen || p.imagen_url || 'https://via.placeholder.com/120'}" class="product-img" />
      <div class="muted">Subi otra imagen para reemplazar (opcional)</div>
    </div>
    <label>Cambiar imagen</label>
    <input id="edit-img" type="file" accept="image/*" />
    <input type="hidden" id="edit-id" value="${p.id}" />
    <div style="display:flex;gap:10px;margin-top:12px">
      <button class="primary" type="submit">Guardar cambios</button>
      <button type="button" class="small" onclick="routeTo('#productos')">Cancelar</button>
    </div>
  `;
  // vincular listener al input file
  document.getElementById('edit-img').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    if(!f.type.startsWith('image/')){ alert('Seleccioná una imagen válida'); e.target.value=''; return; }
    const r = new FileReader();
    r.onload = ()=>{ editImgBase64 = r.result; };
    r.readAsDataURL(f);
  });
}

document.getElementById('form-editar').addEventListener('submit', (ev)=>{
  ev.preventDefault();
  if(!isAdmin()){ showMsg('Solo administradores pueden editar productos',4000); routeTo('#login'); return; }
  const id = parseInt(document.getElementById('edit-id').value);
  const nombre = document.getElementById('edit-nombre').value.trim();
  const precio = parseFloat(document.getElementById('edit-precio').value);
  const stock = parseInt(document.getElementById('edit-stock').value);
  if(!nombre || isNaN(precio) || isNaN(stock)){ alert('Completá los campos'); return; }
  const productos = getProductos();
  const idx = productos.findIndex(x=>x.id===id);
  if(idx===-1){ alert('No encontrado'); return; }
  productos[idx].nombre = nombre;
  productos[idx].precio = precio;
  productos[idx].stock = stock;
  if(editImgBase64){ productos[idx].imagen = editImgBase64; editImgBase64 = ''; document.getElementById('edit-img').value=''; }
  saveProductos(productos);
  showMsg('Producto actualizado'); renderProductos(); routeTo('#productos');
});

/* ---------- Eliminar ---------- */
function eliminarProducto(id){
  if(!confirm('Eliminar producto?')) return;
  const productos = getProductos().filter(p=>p.id!==id);
  saveProductos(productos); renderProductos(); showMsg('Producto eliminado',2000);
}

/* ---------- Edit redirect ---------- */
function irEditar(id){ routeTo(`#editar?id=${id}`); router(); }

/* ---------- Autenticación / Registro ---------- */
document.getElementById('form-registro').addEventListener('submit',(ev)=>{
  ev.preventDefault();
  const usuario = document.getElementById('reg-usuario').value.trim();
  const nombre = document.getElementById('reg-nombre').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value;
  const isadmin = document.getElementById('reg-isadmin').checked;
  if(!usuario || !nombre || !password){ alert('Completá los campos'); return; }
  const usuarios = getUsuarios();
  if(usuarios.some(u=>u.usuario===usuario)){ showMsg('Usuario ya existe',3000); return; }
  usuarios.push({ usuario, nombre, email, password, rol: isadmin ? 'admin' : 'cliente' });
  saveUsuarios(usuarios);
  showMsg('Usuario registrado. Iniciá sesión.',3000); routeTo('#login');
});

document.getElementById('form-login').addEventListener('submit',(ev)=>{
  ev.preventDefault();
  const usuario = ev.target.usuario.value.trim();
  const password = ev.target.password.value;
  const usuarios = getUsuarios();
  const u = usuarios.find(x=>x.usuario===usuario && x.password===password);
  if(!u){ showMsg('Credenciales inválidas',3500); return; }
  setSession(u); renderNav(); showMsg('Bienvenido '+(u.nombre||u.usuario),2000); routeTo('#productos');
});

/* ---------- Admin: render usuarios y cambio de rol ---------- */
function renderUsuarios(){
  const usuarios = getUsuarios(); const tbody = document.getElementById('usuarios-tbody'); tbody.innerHTML='';
  const current = getSession();
  if(usuarios.length===0){ tbody.innerHTML='<tr><td colspan=5>No hay usuarios</td></tr>'; return; }
  usuarios.forEach(u=>{
    if(current && u.usuario===current.usuario) return; // no mostrar a sí mismo
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(u.usuario)}</td><td>${escapeHtml(u.nombre)}</td><td>${escapeHtml(u.email||'')}</td>
      <td><select id="rol-${u.usuario}"><option value="cliente" ${u.rol==='cliente'?'selected':''}>Cliente</option><option value="admin" ${u.rol==='admin'?'selected':''}>Admin</option></select></td>
      <td style="text-align:center"><button class="small" onclick="cambiarRol('${u.usuario}')">Guardar</button></td>`;
    tbody.appendChild(tr);
  });
}

function cambiarRol(username){
  if(!isAdmin()){ showMsg('Acceso denegado',3000); return; }
  const sel = document.getElementById(`rol-${username}`);
  if(!sel) return;
  const usuarios = getUsuarios(); const idx = usuarios.findIndex(x=>x.usuario===username);
  if(idx===-1) return;
  usuarios[idx].rol = sel.value; saveUsuarios(usuarios); showMsg('Rol actualizado',2000);
}

/* ---------- Helpers ---------- */
function isAdmin(){ const s = getSession(); return s && s.rol==='admin'; }
function escapeHtml(str){ if(!str) return ''; return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }
function escapeHtmlAttr(str){ return escapeHtml(str).replaceAll("'", "&#39;"); }

/* ---------- Init ---------- */
document.querySelectorAll('[data-link]').forEach(a=>a.addEventListener('click', ()=>setTimeout(router,60)));
function init(){
  renderNav(); router(); renderProductos();
}
init();

</script>
</body>
</html>
